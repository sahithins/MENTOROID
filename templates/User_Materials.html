{% extends "layout.html" %}
{% block content %}
    <br>
    <br>
    <div class="container">
        <div class="row">
            <!-- Course Content Section -->
            <div class="col-md-4 mb-4 p-4 border border-secondary rounded slide-in">
                <h2 class="h4 font-weight-bold mb-4">Course Content</h2>
                <div class="form-group mb-4">
                    <label for="course" class="font-weight-medium">Select Course</label>
                    <select id="course" name="coursename" class="form-control">
                        <option value="">Select Course</option>
                        {% for course in courses.objects.all() %}
                            {% if course.course_name in enrolled_courses %}
                                <option value="{{ course.course_name }}">{{ course.course_name }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group mb-4">
                    <label for="content-type" class="font-weight-medium">Select Content Type</label>
                    <select id="content-type" name="contenttype" class="form-control">
                        <option value="">Select Content Type</option>
                        <option value="Video">Videos</option>
                        <option value="Material">Materials</option>
                    </select>
                </div>
                <button class="btn btn-primary bounce-in" onclick="searchContent()">View Content</button>
            </div>
    
            <!-- Search Results Section -->
            <div class="col-md-8 p-4 fade-in">
                <h2 class="h4 font-weight-bold mb-4">Search Results</h2>
                <ul class="list-unstyled mb-4">
                    {%for content in contents %}
                        <li class="d-flex justify-content-between align-items-center mb-2">
                            <span>{{ content.title }}</span>
                            <a href="/Download?filename={{ content.upload_file }}" class="text-primary">download</a>
                            <input type="hidden" class="file-name" value="{{ content.upload_file }}">
                        </li>
                    {% endfor %}
                </ul>
                <button class="btn btn-primary bounce-in" onclick="downloadZip()">Zip Download</button>
            </div>
        </div>
    </div>
    <script>
        function searchContent() {
            const query1 = document.getElementById('course').value;
            const query2 = document.getElementById('content-type').value;
            window.location.href = `/search?query1=${encodeURIComponent(query1)}&query2=${encodeURIComponent(query2)}`;
        }
        function downloadZip() {
            const fileNames = Array.from(document.querySelectorAll('.file-name')).map(input => input.value);
            const queryString = fileNames.map(file => `files=${encodeURIComponent(file)}`).join('&');
            window.location.href = `/download_zip?${queryString}`;
        }
    </script>
{% endblock content %}